angular.module("consoleApp",["ui.router","ui.bootstrap","ngCookies","angularMoment","oitozero.ngSweetAlert","angular-loading-bar","ngAnimate","ngStorage","ordinal","ngFileUpload","uiGmapgoogle-maps","mgo-angular-wizard","ui.select2","frapontillo.bootstrap-switch","ui.tree","toastr","ordinal","notification","ngAudio"]).run(["$rootScope","$state","$cookies","$notification","ngAudio","consoleRESTSvc",function(a,b,c,d,e,f){a.faye=new Faye.Client("/faye"),a.user=c.get("user"),a.token=c.get("token"),a.role=c.get("role"),a.sound=e.load("sounds/song1.wav"),a.sound.loop=!0,a.paths=JSON.parse(c.get("paths")||"[]"),a.setHandler=function(b){a.handler=b},a.notification_count=0,_.each(a.paths,function(c){a.faye.subscribe(c,function(c){var e;if(a.handler)a.handler(c);else{console.log("faye message",c),a.notification_count+=1,a.sound.play(),e="new"===c.type?"New Order":"Order Update";var f=d(e,{body:c.message||"Message here",delay:0,dir:"auto"});f.$on("click",function(){console.debug("The user has clicked in my notification."),b.go("console.orders_manage",{show:"new"!==c.type?c.type:void 0},{reload:!0}),f.close()}),f.$on("close",function(){console.debug("The user has closed my notification."),f.close(),a.notification_count-=1,a.notification_count||a.sound.stop()})}})}),a.$on("$stateChangeStart",function(b,c,b,d){"console.orders_manage"===d.name&&(a.handler=void 0),$("document").ready(function(){$(window).scrollTop(0)}),a.current_state=c.name})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("","/"),b.otherwise("/"),a.state("console",{url:"",templateUrl:"templates/header.html",controller:"RootController"}).state("console.default",{url:"/",templateUrl:"templates/merchants/manage.html",controller:"MerchantManageController"}).state("console.login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginController"}).state("console.register_merchant",{url:"/merchants/new",templateUrl:"templates/merchants/register.html",controller:"RegisterMerchantController"}).state("console.outlets_manage",{url:"/outlets",templateUrl:"templates/outlets/manage.html",controller:"OutletManageController"}).state("console.outlets_view",{url:"/outlets/:outlet_id",templateUrl:"templates/outlets/view.html",controller:"OutletViewController"}).state("console.offers_manage",{url:"/offers",templateUrl:"templates/offers/manage.html",controller:"OfferManageController"}).state("console.offers_view",{url:"/offers/:offer_id",templateUrl:"templates/offers/view.html",controller:"OfferViewController"}).state("console.orders_manage",{url:"/orders?show",templateUrl:"templates/orders/manage.html",controller:"OrderManageController"}).state("console.orders_view",{url:"/orders/:order_id",templateUrl:"templates/orders/view.html",controller:"OrderViewController"}).state("console.bills_manage",{url:"/bills",templateUrl:"templates/bills/manage.html",controller:"BillManageController"}).state("console.bills_view",{url:"/bills/:bill_id",templateUrl:"templates/bills/view.html",controller:"BillViewController"}).state("console.menus_create",{url:"/menus/create",templateUrl:"templates/menus/create.html",controller:"MenuCreateController"}).state("console.menus_manage",{url:"/menus",templateUrl:"templates/menus/manage.html",controller:"MenuManageController"}).state("console.menus_edit",{url:"/menus/edit/:menu_id",templateUrl:"templates/menus/edit.html",controller:"MenuEditController"}).state("console.menus_view",{url:"/menus/view/:menu_id",templateUrl:"templates/menus/view.html",controller:"MenuViewController"}).state("console.suggested_outlets_manage",{url:"/suggested_outlets",templateUrl:"templates/suggested_outlets/manage.html",controller:"SuggestedOutletManageController"}).state("console.suggested_offers_manage",{url:"/suggested_offers",templateUrl:"templates/suggested_offers/manage.html",controller:"SuggestedOfferManageController"}).state("console.suggested_offers_view",{url:"/suggested_offers/:suggested_offer_id",templateUrl:"templates/suggested_offers/view.html",controller:"SuggestedOfferViewController"}).state("console.user_feedbacks_manage",{url:"/user_feedbacks",templateUrl:"templates/user_feedbacks/manage.html",controller:"UserFeedbackManageController"}).state("console.write_to_twysts_manage",{url:"/write_to_twyst",templateUrl:"templates/write_to_twyst/manage.html",controller:"WriteToTwystManageController"}).state("console.reported_problems_manage",{url:"/reported_problems",templateUrl:"templates/reported_problems/manage.html",controller:"ReportedProblemManageController"}).state("console.bulk_checkin",{url:"/bulk_checkin",templateUrl:"templates/bulk_checkin/manage.html",controller:"BulkCheckinController"}).state("console.menu_update_requests_manage",{url:"/menu_update_requests",templateUrl:"templates/menu_update_requests/manage.html",controller:"MenuUpdateRequestManageController"}).state("console.shopping_offers_manage",{url:"/shopping_offers",templateUrl:"templates/shopping_offers/manage.html",controller:"ShoppingOffersManageController"}).state("console.shopping_offers_create",{url:"/shopping_offers/create",templateUrl:"templates/shopping_offers/create.html",controller:"ShoppingOfferCreateController"}).state("console.shopping_offers_edit",{url:"/shopping_offers/:offer_id",templateUrl:"templates/shopping_offers/edit.html",controller:"ShoppingOfferUpdateController"}).state("console.cashback_coupon_manage",{url:"/cashback_coupon",templateUrl:"templates/cashback_coupon/manage.html",controller:"CashbackCouponManageController"}).state("console.cashback_coupon_create",{url:"/cashback_coupon/create",templateUrl:"templates/cashback_coupon/create.html",controller:"CashbackCouponCreateController"}).state("console.cashback_coupon_edit",{url:"/cashback_coupon/:offer_id",templateUrl:"templates/cashback_coupon/edit.html",controller:"CashbackCouponUpdateController"}).state("console.promo_notifications",{url:"/notifications",templateUrl:"templates/promo_notifications/manage.html",controller:"PromoNotificationsController"}).state("console.test_payment",{url:"/test_payment",templateUrl:"templates/test_payment.html",controller:"TestPaymentController"})}]),angular.module("consoleApp").controller("BillManageController",["$scope","consoleRESTSvc","$filter",function(a,b,c){a.searchKeywords="",a.bills=[],a.filtered_bills=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_bills=[],b.getAllEvents("upload_bill").then(function(b){console.log(b),a.bills=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_bills=a.filtered_bills.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_bills=c("filter")(a.bills,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_bills=c("orderBy")(a.bills,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_bills=c("orderBy")(a.bills,a.row):a.filtered_bills=a.bills,a.filtered_bills=_.filter(a.filtered_bills,function(a){return-1!==a.event_meta.status.indexOf(b)}),a.onFilterChange()}}]),angular.module("consoleApp").controller("BillViewController",["$scope","SweetAlert","consoleRESTSvc","$stateParams",function(a,b,c,d){a.updateCheck=function(b,c){a[b]=c?!0:!1},c.getOutlets().then(function(b){a.outlets=_.map(b.data,function(a){return{_id:a._id,name:a.basics.name,address:a.contact.location.address,locality_1:a.contact.location.locality_1[0],locality_2:a.contact.location.locality_2[0],city:a.contact.location.city,pin:a.contact.location.pin}})},function(a){a.message&&b.swal("ERROR",a.message,"Error"),console.log(a)}),c.getEvent(d.bill_id).then(function(b){console.log(b),b.data.data.event_meta.timestamp&&(b.data.data.event_meta.timestamp=new Date(b.data.data.event_meta.timestamp)),a.bill=b.data.data,b.data.pending&&(a.pending=angular.copy(b.data.pending))},function(a){a.message&&b.swal("ERROR",a.message,"Error"),console.log(a)}),a.approveBill=function(){a.bill.event_meta.bill_number?a.bill.event_meta.timestamp?a.bill.event_meta.bill_amount?(a.bill.event_meta.issued_for?a.bill.event_meta.status="outlet_pending":a.bill.event_meta.status="twyst_approved",c.updateEvent(a.bill).then(function(c){b.swal("SUCCESS",c.message,"success"),a.bill=c.data},function(a){a.message&&b.swal("ERROR",a.message,"error"),console.log(a)})):b.swal("Validation error","Bill amount required","error"):b.swal("Validation error","Bill date and time required","error"):b.swal("Validation error","Bill Number required","error")},a.updateOutletId=function(b){a.bill.event_outlet=b._id},a.rejectBill=function(){a.bill.event_meta.is_rejected=!0,a.bill.event_meta.status="twyst_rejected",a.isDuplicate?(a.bill.event_meta.status="archived",a.bill.event_meta.reason="Bill is duplicate"):a.isBill?a.isClear?a.isListed?a.bill.event_meta.reason="":a.bill.event_meta.reason="Outlet is not listed on Twyst.":a.bill.event_meta.reason="Bill image is either unclear, incomplete, or manipulated.":a.bill.event_meta.reason="Image is not of a bill.",a.bill.event_meta.reason?c.updateEvent(a.bill).then(function(c){a.bill=c.data,console.log(a.bill),a.isClear=a.isBill=a.isListed=!1,b.swal("SUCCESS",c.message,"success")},function(a){a.message&&b.swal("ERROR",a.message,"error"),console.log(a)}):b.swal("Validation Error","No criteria to base rejection on","error")},a.linkRedemption=function(b){a.bill.event_meta.issued_for=b.issued_for,a.bill.event_meta.pending_coupon=b._id}}]),angular.module("consoleApp").controller("BulkCheckinController",["$scope","consoleRESTSvc","SweetAlert",function(a,b,c){function d(a){for(var b=a.split("\n"),c=[],d=b[0].split(","),e=1;e<b.length;e++){for(var f={},g=b[e].split(","),h=0;h<d.length;h++)void 0!=g[h]&&(f[d[h].trim()]=g[h].trim());c.push(f)}return c}a.fileChanged=function(){var b=new FileReader;b.onload=function(b){a.$apply(function(){a.jsonData=d(b.target.result)})};var c=document.getElementById("fileInput"),e=c.files[0];b.readAsText(e)},a.submitUserList=function(){var d=document.getElementById("fileInput");if(console.log(d.files[0]),!d.files[0])return alert("Plese Upload a CSV File"),!1;for(var e=0;e<a.jsonData.length;e++)if(""!==a.jsonData[e].event_outlet){console.log("here"),console.log(a.jsonData[e]);var f={};f.event_meta={},f.event_meta.phone=a.jsonData[e].phone,f.event_meta.date=new Date,f.event_meta.event_type="bulk_checkin",f.event_outlet=a.jsonData[e].outlet,f.event_date=a.jsonData[e].date,b.bulkCheckin(f).then(function(a){console.log(a),c.swal("SUCCESS","Checkin Successful","success")},function(a){c.swal("ERROR",a.message?a.message:"Unable to Checkin","error"),console.log(a)})}}}]),angular.module("consoleApp").controller("CashbackCouponCreateController",["$scope","consoleRESTSvc","$filter","$modal","SweetAlert","$state",function(a,b,c,d,e,f){a.searchKeywords="",a.view_status="",a.outlets=[],console.log("SweetAlert: ",d),a.filtered_outlets=[],a.coupon={offers:[],code:"#154652",all:!0,only_on_first_order:!0,max_use_limit:15,per_user_limit:"5",start_date:new Date(2016,3,22),end_date:new Date(2016,3,23),actions:{reward:{reward_meta:{reward_type:"flatoff"}}}},a.createCoupon=function(){console.log("coupon",a.coupon),b.createCoupon(a.coupon).then(function(a){console.log("res",a),d.swal({title:"SUCCESS",text:"Coupon created successfully",type:"success"},function(){e.go("^.cashback_coupon_manage",{},{reload:!0})})},function(a){d.swal("Internal Error",a.message?a.message:"Something went wrong","error")})}}]),angular.module("consoleApp").controller("CashbackCouponManageController",["$scope","consoleRESTSvc","$filter",function(a,b,c){a.searchKeywords="",a.coupon_offers=[],a.filtered_coupon_offers=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_coupon_offers=[],b.getCoupons().then(function(b){console.log(b),a.coupon_offers=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return c=(b-1)*a.numPerPage,d=c+a.numPerPage,a.current_page_coupon_offers=a.filtered_coupon_offers.slice(c,d)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_coupon_offers=c("filter")(a.coupon_offers,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_coupon_offers=c("orderBy")(a.coupon_offers,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0}}]),angular.module("consoleApp").controller("LoginController",["$scope","$cookies","$log","$state","$rootScope","consoleRESTSvc","SweetAlert",function(a,b,c,d,e,f,g){a.user={isAdmin:!0},e.token&&d.go("console.orders_manage",{},{reload:!0}),a.logIn=function(){f.login(a.user).then(function(a){console.log(a),b.put("user",a.data.data.email),b.put("token",a.data.data.token),b.put("isPaying",a.data.data.is_paying),b.put("role",a.data.data.role),e.user=a.data.data.email,e.token=a.data.data.token,e.isPaying=a.data.data.is_paying,e.role=a.data.data.role,e.paths=[],2===e.role?(e.paths=["/"+a.data.data.email.replace(".","").replace("@","")],b.put("paths",JSON.stringify(e.paths))):(e.paths=["/console"],b.put("paths",JSON.stringify(e.paths))),g.swal({title:"Logged In Successfully",type:"success",showCancelButton:!1,confirmButtonText:"Continue",closeOnConfirm:!1},function(){d.go("console.orders_manage",{},{reload:!0})})},function(a){g.swal({title:"ERROR",text:a.data?a.data:"Invalid credentials",type:"error",showCancelButton:!1,closeOnConfirm:!0})})}}]),angular.module("consoleApp").controller("MenuCreateController",["$scope","consoleRESTSvc","SweetAlert","$state","$q","$modal",function(a,b,c,d,e,f){a.menu_types=["Dine-In","Takeaway","Delivery","Weekend","Dinner","All"],b.getOutlets().then(function(b){a.outlets=b.data},function(b){a.outlets=[],console.log(b)}),a.menu={status:"active",charge_service_tax:!0,menu_categories:[]},a.toggle=function(a){a.toggle()},a.addCategory=function(){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.category.tmpl.html",controller:"MenuCategoryController",size:"lg",resolve:{category:function(){return{sub_categories:[{sub_category_name:"Default",items:[]}]}},is_new:function(){return!0}}});b.result.then(function(b){a.menu.menu_categories.push(b)})},a.cloneCategory=function(b){c.swal({title:"Clone category!",text:"Are you sure you want to clone this category?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){c&&a.menu.menu_categories.push(_.cloneDeep(a.menu.menu_categories[b]))})},a.editCategory=function(b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.category.tmpl.html",controller:"MenuCategoryController",size:"lg",resolve:{category:function(){return _.cloneDeep(a.menu.menu_categories[b])},is_new:function(){return!0}}});c.result.then(function(c){a.menu.menu_categories[b]=c})},a.removeCategory=function(b){c.swal({title:"Delete category!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.menu.menu_categories.splice(b,1)})},a.addSubCategory=function(a){if(1===a.sub_categories.length&&"Default"===a.sub_categories[0].sub_category_name&&a.sub_categories[0].items.length)c.swal({title:"Are you sure?",text:"Existing items will be shifted to the new sub category",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:"true",confirmButtonText:"Yes, Continue"},function(b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_category.tmpl.html",controller:"MenuSubCategoryController",size:"lg",resolve:{sub_category:function(){return{items:[]}},is_new:function(){return!0}}});c.result.then(function(b){a.sub_categories[0]=_.merge(a.sub_categories[0],b)})});else{var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_category.tmpl.html",controller:"MenuSubCategoryController",size:"lg",resolve:{sub_category:function(){return{items:[]}},is_new:function(){return!0}}});b.result.then(function(b){"Default"===a.sub_categories[0].sub_category_name?a.sub_categories[0]=_.merge(a.sub_categories[0],b):a.sub_categories.push(b)})}},a.cloneSubCategory=function(a,b){c.swal({title:"Clone sub category!",text:"Are you sure you want to clone this sub category?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){c&&a.sub_categories.push(_.cloneDeep(a.sub_categories[b]))})},a.editSubCategory=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_category.tmpl.html",controller:"MenuSubCategoryController",size:"lg",resolve:{sub_category:function(){return _.cloneDeep(a.sub_categories[b])},is_new:function(){return!1}}});c.result.then(function(c){a.sub_categories[b]=c})},a.removeSubCategory=function(a,b){c.swal({title:"Delete sub category!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.sub_categories.splice(b,1)})},a.addItem=function(a){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.item.tmpl.html",controller:"MenuItemController",size:"lg",resolve:{item:function(){return{item_type:"type_1",is_available:!0,option_price_is_additive:!1,option_is_addon:!1,is_vegetarian:!0,is_recommended:!1,item_available_on:[],item_availability:{regular_item:!0},options:[]}},is_new:function(){return!0},limit_access:function(){return!1}}});b.result.then(function(b){a.items.push(b)})},a.cloneItem=function(a,b){c.swal({title:"Clone item!",text:"Are you sure you want to clone this item?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){c&&a.items.push(_.cloneDeep(a.items[b]))})},a.editItem=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.item.tmpl.html",controller:"MenuItemController",size:"lg",resolve:{item:function(){return _.cloneDeep(a.items[b])},is_new:function(){return!1},limit_access:function(){return!1}}});c.result.then(function(c){a.items[b]=c})},a.removeItem=function(a,b){c.swal({title:"Delete item!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.items.splice(b,1)})},a.addOption=function(a){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.option.tmpl.html",controller:"MenuOptionController",size:"lg",resolve:{option:function(){return{is_available:!0,is_vegetarian:!0,sub_options:[],addons:[]}},is_new:function(){return!0},option_title:function(){return a.option_title},limit_access:function(){return!1}}});b.result.then(function(b){a.options.push(b)})},a.cloneOption=function(a,b){c.swal({title:"Clone option!",text:"Are you sure you want to clone this option?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){c&&a.options.push(_.cloneDeep(a.options[b]))})},a.editOption=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.option.tmpl.html",controller:"MenuOptionController",size:"lg",resolve:{option:function(){return _.cloneDeep(a.options[b])},is_new:function(){return!1},option_title:function(){return a.option_title},limit_access:function(){return!1}}});c.result.then(function(c){a.options[b]=c})},a.removeOption=function(a,b){c.swal({title:"Delete option!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.options.splice(b,1)})},a.addSubOption=function(a){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_option.tmpl.html",controller:"MenuSubOptionController",size:"lg",resolve:{sub_option:function(){return{sub_option_set:[]}},is_new:function(){return!0},limit_access:function(){return!1}}});b.result.then(function(b){a.sub_options.push(b)})},a.cloneSubOption=function(a,b){c.swal({title:"Clone sub option!",text:"Are you sure you want to clone these sub options?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){c&&a.sub_options.push(_.cloneDeep(a.sub_options[b]))})},a.editSubOption=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_option.tmpl.html",controller:"MenuSubOptionController",size:"lg",resolve:{sub_option:function(){return _.cloneDeep(a.sub_options[b])},is_new:function(){return!1},limit_access:function(){return!1}}});c.result.then(function(c){a.sub_options[b]=c})},a.removeSubOption=function(a,b){c.swal({title:"Delete sub option set!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.sub_options.splice(b,1)})},a.addAddon=function(a){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.addon.tmpl.html",controller:"MenuAddonController",size:"lg",resolve:{addon:function(){return{addon_set:[]}},is_new:function(){return!0},limit_access:function(){return!1}}});b.result.then(function(b){a.addons.push(b)})},a.cloneAddon=function(a,b){c.swal({title:"Clone addon!",text:"Are you sure you want to clone these addons?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){c&&a.addons.push(_.cloneDeep(a.addons[b]))})},a.editAddon=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.addon.tmpl.html",controller:"MenuAddonController",size:"lg",resolve:{addon:function(){return _.cloneDeep(a.addons[b])},is_new:function(){return!1},limit_access:function(){return!1}}});c.result.then(function(c){a.addons[b]=c})},a.removeAddon=function(a,b){c.swal({title:"Delete addon set!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.addons.splice(b,1)})},a.createMenu=function(){a.reviewMenu().then(function(){b.createMenu(a.menu).then(function(a){c.swal({title:"Menu created successfully",type:"success",showCancelButton:!1,confirmButtonText:"Continue"},function(){d.go("^.menus_manage",{},{reload:!0})})},function(a){console.log(a),a.message?c.swal("Validation Error",a.message,"error"):c.swal("Service Error","Unable to create the menu right now","error")})},function(a){c.swal("Validation error",a,"error")})},a.reviewMenu=function(){var b=e.defer();return a.menu.menu_type?a.menu.menu_item_type?a.menu.outlet?a.menu.menu_categories.length?async.each(a.menu.menu_categories,function(a,b){a.sub_categories.length?async.each(a.sub_categories,function(a,b){a.items.length?b():b("Aleast one item must be present in all sub categories")},function(a){b(a)}):b("Atleast one sub category must be added to all categories")},function(a){a?b.reject(a):b.resolve()}):b.reject("Atleast one category must be added"):b.reject("Please choose an outlet"):b.reject("Please select menu items type"):b.reject("Menu type required"),b.promise}}]),angular.module("consoleApp").controller("MenuEditController",["$scope","consoleRESTSvc","SweetAlert","$state","$q","$modal","$stateParams",function(a,b,c,d,e,f,g){a.menu_types=["Dine-In","Takeaway","Delivery","Weekend","Dinner","All"],a.outlets=[],a.menu={status:"active",menu_categories:[]},b.getOutlets().then(function(b){console.log(b),a.outlets=b.data,a.getMenu()},function(b){console.log(b),a.getMenu()}),a.getMenu=function(){b.getMenu(g.menu_id).then(function(b){console.log(b),a.menu=_.extend(a.menu,b.data),_id=a.menu._id},function(a){console.log(a),c.swal("Service Error",a.message?a.message:"Somthing went wrong.","error")})},a.toggle=function(a){a.toggle()},a.reviewMenu=function(){var b=e.defer();return a.menu.menu_type?a.menu.menu_item_type?a.menu.outlet?a.menu.menu_categories.length?async.each(a.menu.menu_categories,function(a,b){a.sub_categories.length?async.each(a.sub_categories,function(a,b){a.items.length?b():b("Aleast one item must be present in all sub categories")},function(a){b(a)}):b("Atleast one sub category must be added to all categories")},function(a){a?b.reject(a):b.resolve()}):b.reject("Atleast one category must be added"):b.reject("Please choose an outlet"):b.reject("Please select menu items type"):b.reject("Menu type required"),b.promise},a.updateMenu=function(){a.reviewMenu().then(function(){b.updateMenu(a.menu).then(function(a){c.swal({title:"Menu updated successfully",type:"success",showCancelButton:!1,confirmButtonText:"Continue"},function(){d.go("^.menus_manage",{},{reload:!0})})},function(a){console.log(a),a.message?c.swal("Validation Error",a.message,"error"):c.swal("Service Error","Unable to update the menu right now","error")})},function(a){c.swal("Validation error",a,"error")})},a.addCategory=function(){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.category.tmpl.html",controller:"MenuCategoryController",size:"lg",resolve:{category:function(){return{sub_categories:[{sub_category_name:"Default",items:[]}]}},is_new:function(){return!0}}});b.result.then(function(b){a.menu.menu_categories.push(b)})},a.editCategory=function(b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.category.tmpl.html",controller:"MenuCategoryController",size:"lg",resolve:{category:function(){return _.cloneDeep(a.menu.menu_categories[b])},is_new:function(){return!0}}});c.result.then(function(c){a.menu.menu_categories[b]=c})},a.cloneCategory=function(b){c.swal({title:"Clone category!",text:"Are you sure you want to clone this category?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){if(c){var d=_.cloneDeep(a.menu.menu_categories[b]);delete d._id,_.each(d.sub_categories,function(a){delete a._id,_.each(a.items,function(a){delete a._id,_.each(a.options,function(a){delete a._id,_.each(a.sub_options,function(a){delete a._id,_.each(a.sub_option_set,function(a){delete a._id})}),_.each(a.addons,function(a){delete a._id,_.each(a.addon_set,function(a){delete a._id})})})})}),a.menu.menu_categories.push(_.cloneDeep(a.menu.menu_categories[b]))}})},a.removeCategory=function(b){c.swal({title:"Delete category!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.menu.menu_categories.splice(b,1)})},a.addSubCategory=function(a){if(1===a.sub_categories.length&&"Default"===a.sub_categories[0].sub_category_name&&a.sub_categories[0].items.length)c.swal({title:"Are you sure?",text:"Existing items will be shifted to the new sub category",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:"true",confirmButtonText:"Yes, Continue"},function(b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_category.tmpl.html",controller:"MenuSubCategoryController",size:"lg",resolve:{sub_category:function(){return{items:[]}},is_new:function(){return!0}}});c.result.then(function(b){a.sub_categories[0]=_.merge(a.sub_categories[0],b)})});else{var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_category.tmpl.html",controller:"MenuSubCategoryController",size:"lg",resolve:{sub_category:function(){return{items:[]}},is_new:function(){return!0}}});b.result.then(function(b){"Default"===a.sub_categories[0].sub_category_name?a.sub_categories[0]=_.merge(a.sub_categories[0],b):a.sub_categories.push(b)})}},a.editSubCategory=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_category.tmpl.html",controller:"MenuSubCategoryController",size:"lg",resolve:{sub_category:function(){return _.cloneDeep(a.sub_categories[b])},is_new:function(){return!1}}});c.result.then(function(c){a.sub_categories[b]=c})},a.cloneSubCategory=function(a,b){c.swal({title:"Clone sub category!",text:"Are you sure you want to clone this sub category?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){if(c){var d=_.cloneDeep(a.sub_categories[b]);delete d._id,_.each(d.items,function(a){delete a._id,_.each(a.options,function(a){delete a._id,_.each(a.sub_options,function(a){delete a._id,_.each(a.sub_option_set,function(a){delete a._id})}),_.each(a.addons,function(a){delete a._id,_.each(a.addon_set,function(a){delete a._id})})})}),a.sub_categories.push(d)}})},a.removeSubCategory=function(a,b){c.swal({title:"Delete sub category!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.sub_categories.splice(b,1)})},a.addItem=function(a){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.item.tmpl.html",controller:"MenuItemController",size:"lg",resolve:{item:function(){return{item_type:"type_1",is_available:!0,option_price_is_additive:!1,option_is_addon:!1,is_vegetarian:!0,is_recommended:!1,item_available_on:[],item_availability:{regular_item:!0},options:[]}},is_new:function(){return!0},limit_access:function(){return!1}}});b.result.then(function(b){a.items.push(b)})},a.editItem=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.item.tmpl.html",controller:"MenuItemController",size:"lg",resolve:{item:function(){return _.cloneDeep(a.items[b])},is_new:function(){return!1},limit_access:function(){return!1}}});c.result.then(function(c){a.items[b]=c})},a.cloneItem=function(a,b){c.swal({title:"Clone item!",text:"Are you sure you want to clone this item?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){if(c){var d=_.cloneDeep(a.items[b]);delete d._id,_.each(d.options,function(a){delete a._id,_.each(a.sub_options,function(a){delete a._id,_.each(a.sub_option_set,function(a){delete a._id})}),_.each(a.addons,function(a){delete a._id,_.each(a.addon_set,function(a){delete a._id})})}),a.items.push(d)}})},a.removeItem=function(a,b){c.swal({title:"Delete item!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.items.splice(b,1)})},a.addOption=function(a){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.option.tmpl.html",controller:"MenuOptionController",size:"lg",resolve:{option:function(){return{is_available:!0,is_vegetarian:!0,sub_options:[],addons:[]}},is_new:function(){return!0},option_title:function(){return a.option_title},limit_access:function(){return!1}}});b.result.then(function(b){a.options.push(b)})},a.editOption=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.option.tmpl.html",controller:"MenuOptionController",size:"lg",resolve:{option:function(){return _.cloneDeep(a.options[b])},is_new:function(){return!1},option_title:function(){return a.option_title},limit_access:function(){return!1}}});c.result.then(function(c){a.options[b]=c})},a.cloneOption=function(a,b){c.swal({title:"Clone option!",text:"Are you sure you want to clone this option?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){if(c){var d=_.cloneDeep(a.options[b]);delete d._id,_.each(d.sub_options,function(a){delete a._id,_.each(a.sub_option_set,function(a){delete a._id})}),_.each(d.addons,function(a){delete a._id,_.each(a.addon_set,function(a){delete a._id})}),a.options.push(d)}})},a.removeOption=function(a,b){c.swal({title:"Delete option!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.options.splice(b,1)})},a.addSubOption=function(a){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_option.tmpl.html",controller:"MenuSubOptionController",
size:"lg",resolve:{sub_option:function(){return{sub_option_set:[]}},is_new:function(){return!0},limit_access:function(){return!1}}});b.result.then(function(b){a.sub_options.push(b)})},a.editSubOption=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.sub_option.tmpl.html",controller:"MenuSubOptionController",size:"lg",resolve:{sub_option:function(){return _.cloneDeep(a.sub_options[b])},is_new:function(){return!1},limit_access:function(){return!0}}});c.result.then(function(c){a.sub_options[b]=c})},a.cloneSubOption=function(a,b){c.swal({title:"Clone sub option!",text:"Are you sure you want to clone these sub options?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){if(c){var d=_.cloneDeep(a.sub_options[b]);delete d._id,_.each(d.sub_option_set,function(a){delete a._id}),a.sub_options.push(d)}})},a.removeSubOption=function(a,b){c.swal({title:"Delete sub option set!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.sub_options.splice(b,1)})},a.addAddon=function(a){var b=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.addon.tmpl.html",controller:"MenuAddonController",size:"lg",resolve:{addon:function(){return{addon_set:[]}},is_new:function(){return!0},limit_access:function(){return!1}}});b.result.then(function(b){a.addons.push(b)})},a.editAddon=function(a,b){var c=f.open({animation:!0,templateUrl:"../common/templates/partials/menu.addon.tmpl.html",controller:"MenuAddonController",size:"lg",resolve:{addon:function(){return _.cloneDeep(a.addons[b])},is_new:function(){return!1},limit_access:function(){return!1}}});c.result.then(function(c){a.addons[b]=c})},a.cloneAddon=function(a,b){c.swal({title:"Clone addon!",text:"Are you sure you want to clone these addons?",type:"info",showCancelButton:!0,confirmButtonText:"Clone It!"},function(c){if(c){var d=_.cloneDeep(a.addons[b]);delete d._id,_.each(d.addon_set,function(a){delete a._id}),a.addons.push(d)}})},a.removeAddon=function(a,b){c.swal({title:"Delete addon set!",text:"Are you sure you want to delete?",type:"warning",confirmButtonColor:"#DD6B55",showCancelButton:!0,confirmButtonText:"Delete It!"},function(c){c&&a.addons.splice(b,1)})}}]),angular.module("consoleApp").controller("MenuManageController",["$scope","consoleRESTSvc","$filter","$modal","SweetAlert",function(a,b,c,d,e){a.searchKeywords="",a.menus=[],a.filtered_menus=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_menus=[],a.getMenus=function(){b.getMenus().then(function(b){console.log(b),a.menus=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)})},a.getMenus(),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_menus=a.filtered_menus.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_menus=c("filter")(a.menus,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!=b?(a.row=b,a.filtered_menus=c("orderBy")(a.menus,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_menus=c("orderBy")(a.menus,a.row):a.filtered_menus=a.menus,a.filtered_menus=_.filter(a.filtered_menus,function(a){return-1!==a.status.indexOf(b)}),a.onFilterChange()},a.cloneMenu=function(b,c){var e=d.open({animation:!0,templateUrl:"../common/templates/partials/menu.clone.tmpl.html",controller:"MenuCloneController",size:"lg",resolve:{menu_id:function(){return b},outlet_id:function(){return c}}});e.result.then(function(){a.getMenus()})},a.removeMenu=function(c){e.swal({title:"Are you sure?",text:"You will not be able to recover this menu",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Delete It!",closeOnConfirm:!1},function(d){d&&b.deleteMenu(c).then(function(b){e.swal("SUCCESS","Menu deleted successfully","success"),a.getMenus()},function(a){e.swal({title:"ERROR",text:"Unable to delete this menu right now",type:"error",showCancelButton:!1,confirmButtonColor:"#DD6B55",confirmButtonText:"Continue",closeOnConfirm:!0})})})}}]),angular.module("consoleApp").controller("MenuUpdateRequestManageController",["$scope","consoleRESTSvc","$filter","$modal","SweetAlert",function(a,b,c,d,e){a.searchKeywords="",a.requests=[],a.filtered_requests=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_requests=[],b.getAllEvents("menu_update").then(function(b){console.log(b),a.requests=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_requests=a.filtered_requests.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_requests=c("filter")(a.requests,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!=b?(a.row=b,a.filtered_requests=c("orderBy")(a.requests,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){a.row?a.filtered_requests=c("orderBy")(a.requests,a.row):a.filtered_requests=a.requests,a.filtered_requests=_.filter(a.filtered_requests,function(a){return-1!==a.event_meta.status.indexOf(b)}),a.onFilterChange()},a.updateStatus=function(a){b.updateEvent(a).then(function(a){e.swal("Status Updated"," ","success")},function(a){console.log(a),e.swal("Internal error","Sonething went wrong. Please try after some time.","error")})}}]),angular.module("consoleApp").controller("MenuViewController",["$scope","consoleRESTSvc","SweetAlert","$state","$q","$modal","$stateParams",function(a,b,c,d,e,f,g){b.getOutlets().then(function(b){a.outlets=b.data,a.getMenu()},function(b){a.outlets=[],console.log(b),a.getMenu()}),a.menu={status:"active",menu_categories:[]},a.getMenu=function(){b.getMenu(g.menu_id).then(function(b){a.menu=_.extend(a.menu,b.data)},function(a){a.message?c.swal("Service Error",a.message,"error"):c.swal("Service Error","Something went wrong.","error")})},a.toggle=function(a){a.toggle()}}]),angular.module("consoleApp").controller("MerchantManageController",["$scope","$rootScope","consoleRESTSvc",function(a,b,c){c.getOutlets().then(function(b){a.outlets=_.map(b.data,function(a){return{name:a.basics.name,loc1:a.contact.location.locality_1[0],loc2:a.contact.location.locality_2[0],pin:a.contact.location.pin}})},function(a){console.log(a)})}]),angular.module("consoleApp").controller("RegisterMerchantController",["$scope","consoleRESTSvc","SweetAlert",function(a,b,c){a.init=function(){a.merchant={isPaying:!1,is_merchant:!0}},a.init(),a.registerMerchant=function(){if(a.merchant)if(a.merchant.username)if(a.merchant.password)if(a.merchant.rePassword)if(_.isEqual(a.merchant.password,a.merchant.rePassword))if(a.merchant.isPaying&&!a.merchant.email)c.swal("Validation error","Email ID required","error");else{var d={username:a.merchant.username.toLowerCase(),password:a.merchant.password,isPaying:!1,role:3};a.merchant.is_merchant||(d.role=2),a.merchant.isPaying&&(d.isPaying=!0),(a.merchant.isPaying||!a.merchant.is_merchant)&&(d.email=a.merchant.email),b.registerMerchant(d).then(function(b){b.response?(c.swal("SUCCESS",b.message,"success"),a.init()):c.swal("ERROR",b.message,"error")},function(a){c.swal(a.info.message?a.info.message:"Failed to register merchant. Please twy again after sometime","error")})}else c.swal("Validation error","Passwords do not match","error");else c.swal("Validation error","Please retype the password","error");else c.swal("Validation error","Password required","error");else c.swal("Validation error","Username required","error");else c.swal("Validation error","Please fill-in the details first","error")},a.isPayingUpdated=function(){a.merchant.isPaying||(a.merchant.email="")}}]),angular.module("consoleApp").controller("ShoppingOfferTemplateController",["$scope","$modalInstance","is_new","shopping_offer","SweetAlert","$q",function(a,b,c,d,e,f){a.is_new=c,a.shopping_offer={},a.shopping_offer=_.merge(a.shopping_offer,d),console.log("shopping_offer",d),a.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],a.resolveOffer=function(){a.validateOffer().then(function(c){a.shopping_offer._id=_id,_id=void 0,b.close(a.shopping_offer)},function(a){e.swal("Validation error",a,"error")})},a.discardOffer=function(){b.dismiss("Cancel")},a.getMaxRange=function(){return new Array(_.reduce(a.shopping_offer.offer_applicability,function(a,b){return _.has(a,"timings")?a.timings.length>b.timings.length?a.timings.length:b.timings.length:a>=b.timings.length?a:b.timings.length}))},a.initalizeTiming=function(a,b,c){if(!c[a].timings[b].open||!c[a].timings[b].close){var d=new Date;d.setHours(9),d.setMinutes(0),d.setSeconds(0),d.setMilliseconds(0);var e=new Date;e.setHours(21),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),c[a].timings[b]={open:{hr:9,min:0,time:d},close:{hr:21,min:0,time:e}}}},a.addNewTiming=function(a,b){b[a].timings.push({})},a.removeTiming=function(a,b,c){c[a].timings.splice(b,1)},a.updateTiming=function(a,b){b[a].closed?b[a].timings=[]:b[a].timings=[{}]},a.updateTime=function(a,b,c){var d=c[a].timings[b];d.open.time&&(d.open.hr=d.open.time.getHours(),d.open.min=d.open.time.getMinutes()),d.close.time&&(d.close.hr=d.close.time.getHours(),d.close.min=d.close.time.getMinutes())},a.cloneToAllDays=function(a,b){_.each(b,function(c,d){d!==a&&(c.timings=_.cloneDeep(b[a].timings),c.closed=b[a].closed)})},a.scrollToTop=function(){$("document").ready(function(){$(window).scrollTop(0)})},a.validateOffer=function(){var b=f.defer();return a.shopping_offer?_.get(a.shopping_offer,"offer_value")?_.get(a.shopping_offer,"offer_type")?_.get(a.shopping_offer,"offer_voucher_count")?_.get(a.shopping_offer,"offer_text")?_.get(a.shopping_offer,"offer_cost")?_.get(a.shopping_offer,"offer_processing_fee")?_.get(a.shopping_offer,"offer_status")?_.get(a.shopping_offer,"offer_start_date")?_.get(a.shopping_offer,"offer_end_date")?async.each(a.days,function(b,c){var d=a.shopping_offer.offer_applicability[b];d.closed?c():async.each(d.timings,function(a,c){!a.open.hr&&0!==a.open.hr||!a.open.min&&0!==a.open.min||!a.close.hr&&0!==a.close.hr||!a.close.min&&0!==a.close.min?c("One or more timings invalid for "+b.toUpperCase()):async.each(d.timings,function(c,d){if(!c.open.hr&&0!==c.open.hr||!c.open.min&&0!==c.open.min||!c.close.hr&&0!==c.close.hr||!c.close.min&&0!==c.close.min)d("One or more timings invalid for "+b.toUpperCase());else{var e=60*a.open.hr+a.open.min,f=60*a.close.hr+a.close.min,g=60*c.open.hr+c.open.min,h=60*c.close.hr+c.close.min;a===c?d():h>=e&&f>=h||g>=e&&f>=g||f>=g&&h>=f?d("One or more timings invalid for "+b.toUpperCase()):d()}},function(a){c(a)})},function(a){c(a)})},function(c){c?(a.showErrorMessage(c),b.reject()):(a.scrollToTop(),a.formFailure=!1,b.resolve(!0))}):b.reject("Valid offer end date required"):b.reject("Valid offer start date required"):b.reject("Please choose a valid offer status"):b.reject("Offer processing fee (in Twyst Bucks) required"):b.reject("Offer cost (in Twyst Bucks) required"):b.reject("Offer text required"):b.reject("Total voucher count required"):b.reject("Please choose the offer type"):b.reject("Offer value cannot be left blank."):b.reject("Form not filled in yet"),b.promise}}]),angular.module("consoleApp").controller("MenuAddonController",["$scope","$modalInstance","addon","is_new","limit_access","SweetAlert",function(a,b,c,d,e,f){a.is_new=d,a.addon=c,a.limit_access=e,a.addValuePair=function(){a.addon.addon_set.push({is_vegetarian:!0})},a.removeValuePair=function(b){a.addon.addon_set.splice(b,1)},a.resolveAddon=function(){a.addon.addon_title?a.addon.addon_set&&a.addon.addon_set.length?async.each(a.addon.addon_set,function(a,b){a.addon_value?a.addon_cost||0===a.addon_cost?b():b("No addon cost can be left blank"):b("No addon name can be left blank")},function(c){c?f.error("Validation Error",c,"error"):b.close(a.addon)}):f.swal("Validation Error","Please provide atleast one value pair","error"):f.swal("Validation Error","Title required","error")},a.discardAddon=function(){b.dismiss("Cancel")}}]),angular.module("consoleApp").controller("MenuCategoryController",["$scope","$modalInstance","category","is_new","SweetAlert",function(a,b,c,d,e){a.menu_categories=["Indian","Dessert","Cakes","Chinese","Soup"],a.is_new=d,a.category=c,a.resolveCategory=function(){a.category.category_name?b.close(a.category):e.swal("Validation Error","Category Name cannot be left blank","error")},a.discardCategory=function(){b.dismiss("Cancel")}}]),angular.module("consoleApp").controller("MenuCloneController",["$scope","$modalInstance","menu_id","outlet_id","SweetAlert","consoleRESTSvc",function(a,b,c,d,e,f){a.req_obj={menu:c},f.getOutlets().then(function(b){a.outlets=_.filter(b.data,function(a){return a._id!==d})},function(b){a.outlets=[],console.log(b)}),a.cloneMenu=function(){a.req_obj.outlet?f.cloneMenu(c,a.req_obj.outlet).then(function(a){b.close()},function(a){var c=a.message?a.message:"Unable to clone the menu right now";e.swal({title:"Service error",text:c,type:"error",showCancelButton:!1,confirmButtonColor:"#DD6B55",confirmButtonText:"Continue",closeOnConfirm:!0},function(){b.dismiss()})}):e.swal("Error!","Please select an outlet first","error")},a.cancel=function(){b.dismiss("Cancel")}}]),angular.module("consoleApp").controller("MenuItemController",["$scope","$modalInstance","$modal","item","is_new","limit_access","SweetAlert","$q",function(a,b,c,d,e,f,g,h){a.is_new=e,a.limit_access=f,a.item=d,e||(_.each(a.days,function(b){a.checkModel[b]=-1!==a.item.item_available_on.indexOf(b)?!0:!1}),a.item.item_availability.start_date&&(a.item.item_availability.start_date=new Date(a.item.item_availability.start_date)),a.item.item_availability.end_date&&(a.item.item_availability.end_date=new Date(a.item.item_availability.end_date))),a.checkModal={},a.days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.$watchCollection("checkModal",function(){a.item.item_available_on=[],angular.forEach(a.checkModal,function(b,c){b&&a.item.item_available_on.push(c)})}),a.updateItemTimings=function(b,d){if(b===!0||b===!1)if(a.item.item_availability.regular_item===!0)delete a.item.item_availability.start_date,delete a.item.item_availability.end_date,a.item.item_availability.days_of_the_week=[],a.item.item_availability.available_hours={monday:{closed:!1,timings:[{}]},tuesday:{closed:!1,timings:[{}]},wednesday:{closed:!1,timings:[{}]},thursday:{closed:!1,timings:[{}]},friday:{closed:!1,timings:[{}]},saturday:{closed:!1,timings:[{}]},sunday:{closed:!1,timings:[{}]}};else{var e=c.open({animation:!0,templateUrl:"../common/templates/partials/menu.item_timings.tmpl.html",size:"lg",controller:"MenuItemTimingsController",resolve:{item:function(){return _.cloneDeep(a.item)}}});e.result.then(function(b){console.log("item_obj",b),a.item=b},function(){d||(a.item.item_availability.regular_item=!0)})}},a.resolveItem=function(){a.validateItem().then(function(){b.close(a.item)},function(a){g.swal("Validation Erorr",a,"error")})},a.discardItem=function(){b.dismiss("Cancel")},a.validateItem=function(){var b=h.defer();return a.item.item_name?a.item.item_cost||0===a.item.item_cost?a.item.item_tags&&a.item.item_tags.length?a.item.item_type?b.resolve():b.reject("Item type must be selected"):b.reject("Atleast one tag required"):b.reject("Item cost required."):b.reject("Item name required."),b.promise}}]),angular.module("consoleApp").controller("MenuItemTimingsController",["$scope","$modalInstance","item","SweetAlert","$q",function(a,b,c,d,e){a.item={item_availability:{available_hours:{monday:{closed:!1,timings:[{}]},tuesday:{closed:!1,timings:[{}]},wednesday:{closed:!1,timings:[{}]},thursday:{closed:!1,timings:[{}]},friday:{closed:!1,timings:[{}]},saturday:{closed:!1,timings:[{}]},sunday:{closed:!1,timings:[{}]}},days_of_the_week:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]}},a.check_days={monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!0,sunday:!0},a.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],a.item=_.merge(a.item,c),_.each(a.days,function(b){-1===a.item.item_availability.days_of_the_week.indexOf(b)&&(a.check_days[b]=!1)}),a.item.item_availability.start_date&&(a.item.item_availability.start_date=new Date(a.item.item_availability.start_date)),a.item.item_availability.end_date&&(a.item.item_availability.end_date=new Date(a.item.item_availability.end_date)),a.$watchCollection("check_days",function(b){b&&(a.item.item_availability.days_of_the_week=_.compact(_.map(b,function(a,b){return a?b:void 0})))}),a.getMaxRange=function(){return new Array(_.reduce(a.item.item_availability.available_hours,function(a,b){return _.has(a,"timings")?a.timings.length>b.timings.length?a.timings.length:b.timings.length:a>=b.timings.length?a:b.timings.length}))},a.initializeTiming=function(a,b,c){if(c[a].timings[b].open&&c[a].timings[b].close){var d=new Date;d.setHours(c[a].timings[b].open.hr),d.setMinutes(c[a].timings[b].open.min),d.setSeconds(0),d.setMilliseconds(0);var e=new Date;e.setHours(c[a].timings[b].close.hr),e.setMinutes(c[a].timings[b].close.min),e.setSeconds(0),e.setMilliseconds(0),c[a].timings[b].open.time=d,c[a].timings[b].close.time=e}else{var d=new Date;d.setHours(0),d.setMinutes(1),d.setSeconds(0),d.setMilliseconds(0);var e=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),c[a].timings[b]={open:{hr:0,min:1,time:d},close:{hr:0,min:0,time:e}}}},a.updateTiming=function(a,b){b[a].closed?b[a].timings=[]:b[a].timings=[{}]},a.removeTiming=function(a,b,c){c[a].timings.splice(b,1)},a.updateTime=function(a,b,c){var d=c[a].timings[b];d.open.time&&(d.open.hr=d.open.time.getHours(),d.open.min=d.open.time.getMinutes()),d.close.time&&(d.close.hr=d.close.time.getHours(),d.close.min=d.close.time.getMinutes())},a.addNewTiming=function(a,b){b[a].timings.push({})},a.cloneToAllDays=function(a,b){_.each(b,function(c,d){d!==a&&(c.timings=_.cloneDeep(b[a].timings),c.closed=b[a].closed)})},a.validate_timings=function(){var b=e.defer();return _.get(a.item,"item_availability.start_date")&&!_.get(a.item,"item_availability.end_date")||!_.get(a.item,"item_availability.start_date")&&_.get(a.item,"item_availability.end_date")?b.reject('Either specify "both" or "neither" start date and end date.'):a.item.item_availability.start_date&&a.item.item_availability.end_date&&a.item.item_availability.start_date>=a.item.item_availability.end_date?b.reject("Start date must be before end date"):_.get(a.item,"item_availability.days_of_the_week")&&a.item.item_availability.days_of_the_week.length?b.resolve():b.reject("Item must be available on atleast one day"),b.promise},a.resolveChanges=function(){a.validate_timings().then(function(){b.close(a.item)},function(a){d.swal("Validtion error",a,"error")})},a.discardChanges=function(){b.dismiss("Cancel")}}]),angular.module("consoleApp").controller("MenuOptionController",["$scope","$modalInstance","option","is_new","limit_access","option_title","SweetAlert",function(a,b,c,d,e,f,g){a.is_new=d,a.option=c,a.option_title=f,a.limit_access=e,a.resolveOption=function(){a.option.option_value?a.option.option_cost||0===a.option.option_cost?b.close(a.option):g.swal("Validation Error","Option cost required","error"):g.swal("Validation Error","Option name required","error")},a.discardOption=function(){b.dismiss("Cancel")}}]),angular.module("consoleApp").controller("MenuSubCategoryController",["$scope","$modalInstance","sub_category","is_new","SweetAlert",function(a,b,c,d,e){a.is_new=d,a.sub_category=c,a.sub_category_name=["Veg Starter","Non-Veg Starter","Veg Main Course","Non-Veg Main Course"],a.resolveSubCategory=function(){a.sub_category.sub_category_name?b.close(a.sub_category):e.swal("Validation Error","Sub category name cannot be left blank","error")},a.discardSubCategory=function(){b.dismiss("Cancel")}}]),angular.module("consoleApp").controller("MenuSubOptionController",["$scope","$modalInstance","sub_option","is_new","limit_access","SweetAlert",function(a,b,c,d,e,f){a.is_new=d,a.sub_option=c,a.limit_access=e,a.addValuePair=function(){a.sub_option.sub_option_set.push({is_vegetarian:!0})},a.removeValuePair=function(b){a.sub_option.sub_option_set.splice(b,1)},a.resolveSubOption=function(){a.sub_option.sub_option_title?a.sub_option.sub_option_set&&a.sub_option.sub_option_set.length?async.each(a.sub_option.sub_option_set,function(a,b){a.sub_option_value?a.sub_option_cost||0===a.sub_option_cost?b():b("No sub option cost can be left blank"):b("No sub option name can be left blank")},function(c){c?f.swal("Validation Error",c):b.close(a.sub_option)}):f.swal("Validation Error","Please provide atleast one value pair","error"):f.swal("Validation Error","Title required","error")},a.discardSubOption=function(){b.dismiss("Cancel")}}]),angular.module("consoleApp").controller("CashbackCommissionController",["$scope","$modalInstance","outlet","SweetAlert","consoleRESTSvc","$q",function(a,b,c,d,e,f){a.outlet=c,a.updateCommission=function(){a.outlet.twyst_meta.twyst_commission.is_fixed?a.outlet.twyst_meta.twyst_commission.commission_slab=[]:(delete a.outlet.twyst_meta.twyst_commission.value,a.addCommissionSlab())},a.addCommissionSlab=function(){a.outlet.twyst_meta.twyst_commission.commission_slab.push({})},a.addCashbackSlab=function(){a.outlet.twyst_meta.cashback_info.order_amount_slab.push({})},a.removeSlab=function(a,b){a.splice(b,1)},a.validateCommission=function(){var b=f.defer(),c=!1;return _.get(a.outlet,"twyst_meta.twyst_commission.is_fixed")&&!_.get(a.outlet,"twyst_meta.twyst_commission.value")?b.reject("Fixed commission requires commisssion percentage"):async.each(a.outlet.twyst_meta.twyst_commission.commission_slab,function(b,d){b.start||0===b.start?b.value?b.end?b.end<=b.start?d("Slab start must be lesser than slab end"):async.each(a.outlet.twyst_meta.twyst_commission.commission_slab,function(a,c){b===a?c():b.start<=(a.end||99999999)&&(a.end||99999999)<=(b.end||99999999)||b.start<=a.start&&a.start<=(b.end||99999999)||a.start<=(b.end||99999999)&&(b.end||99999999)<=(a.end||99999999)?c("One or more commission slabs are conflicting"):c()},function(a){console.log("err",a),d(a)}):c?d("Exactly one commission should not have an upper bound."):(c=!0,d()):d("All commission slabs must have valid commission percentage"):d("All commission slabs must have valid start amount")},function(d){d?b.reject(d):_.get(a.outlet,"twyst_meta.twyst_commission.is_fixed")||c?b.resolve():b.reject("A commission slab with no upper bound required")}),b.promise},a.validateCashback=function(){var b=f.defer(),c=!1;return _.get(a.outlet,"twyst_meta.cashback_info.base_cashback")||0===_.get(a.outlet,"twyst_meta.cashback_info.base_cashback")?_.get(a.outlet,"twyst_meta.cashback_info.in_app_ratio")?_.get(a.outlet,"twyst_meta.cashback_info.cod_ratio")?async.each(a.outlet.twyst_meta.cashback_info.order_amount_slab,function(b,d){b.start||0===b.start?b.ratio?b.end?b.end<=b.start?d("Slab start must be lesser than slab end"):async.each(a.outlet.twyst_meta.cashback_info.order_amount_slab,function(a,c){b===a?c():b.start<=(a.end||99999999)&&(a.end||99999999)<=(b.end||99999999)||b.start<=a.start&&a.start<=(b.end||99999999)||a.start<=(b.end||99999999)&&(b.end||99999999)<=(a.end||99999999)?c("One or more commission slabs are conflicting"):c()},function(a){d(a)}):c?d("Exactly one commission should not have an upper bound."):(c=!0,d()):d("Cashback ratio required for all slabs."):d("All cashback slabs must have valid starting amount")},function(d){d?b.reject(d):_.get(a.outlet,"twyst_meta.cashback_info.order_amount_slab")&&0!==a.outlet.twyst_meta.cashback_info.order_amount_slab.length&&!c?b.reject("Eactly one cashback slab must not have an upper bound"):b.resolve()}):b.reject("Commission ratio required for C.O.D. payment"):b.reject("Commission ratio required for In-App payment"):b.reject("Base cashback percent required"),b.promise},a.updateInfo=function(){var c=function(b){a.formFailure=!0,d.swal("Validation Error",b,"error")};a.validateCommission().then(function(){a.validateCashback().then(function(){e.updateOutlet(a.outlet).then(function(c){console.log(c),d.swal("SUCCESS","Cashback and Commission updated successfully","success"),b.close(a.outlet)},function(a){console.log(a)})},function(a){c(a)})},function(a){c(a)})},a.discardInfo=function(){b.dismiss("Cancel")}}]),angular.module("consoleApp").controller("OfferManageController",["$scope","consoleRESTSvc","$filter","SweetAlert",function(a,b,c,d){a.searchKeywords="",a.offers=[],a.filtered_offers=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_offers=[],b.getOffers().then(function(b){console.log(b),a.offers=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_offers=a.filtered_offers.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_offers=c("filter")(a.offers,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_offers=c("orderBy")(a.offers,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_offers=c("orderBy")(a.offers,a.row):a.filtered_offers=a.offers,a.filtered_offers=_.filter(a.filtered_offers,function(a){return-1!==a.offer_status.indexOf(b)}),a.onFilterChange()},a.updateOfferStatus=function(a){b.updateOfferStatus(a).then(function(a){console.log(a),d.swal("SUCCESS","Offer status updated","success")},function(a){console.log(a),a.message?d.swal("ERROR",a.message,"error"):d.swal("ERROR","Unable to update the offer status right now","error")})}}]),angular.module("consoleApp").controller("OfferViewController",["$scope","consoleRESTSvc","$stateParams","SweetAlert",function(a,b,c,d){a.outlets={},a.offer={},a.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],a.reward_types={buyonegetone:"Buy One Get One",discount:"Discount",flatoff:"Flat Off",free:"Free",happyhours:"Happy Hours",reduced:"Reduced Price",custom:"Custom",unlimited:"Unlimited",onlyhappyhours:"Only Happy Hours",combo:"Combo",buffet:"Buffet",buyxgety:"Buy X Get Y"},b.getOutlets().then(function(b){console.log(b),a.outlets=_.indexBy(b.data,"_id")},function(a){console.log(a)}),b.getOffer(c.offer_id).then(function(b){console.log(b),b.data.offer_cost&&(b.data.offer_cost=b.data.offer_cost.toString()),a.offer=_.merge(a.offer,b.data),console.log(a.offer),angular.forEach(a.offer.actions.reward.reward_hours,function(a){a.closed||angular.forEach(a.timings,function(a){a.open.time=new Date,a.close.time=new Date,a.open.time.setMilliseconds(0),a.open.time.setSeconds(0),a.close.time.setMilliseconds(0),a.close.time.setSeconds(0),a.open.time.setHours(a.open.hr),a.open.time.setMinutes(a.open.min),a.close.time.setHours(a.close.hr),a.close.time.setMinutes(a.close.min)})})},function(a){console.log(a)}),a.updateOfferStatus=function(a){b.updateOfferStatus(a).then(function(a){console.log(a),d.swal("SUCCESS","Offer status updated","success")},function(a){console.log(a),a.message?d.swal("ERROR",a.message,"error"):d.swal("ERROR","Unable to update the offer status right now","error")})}}]),angular.module("consoleApp").controller("OrderViewController",["$scope","$modalInstance","order","consoleRESTSvc","SweetAlert",function(a,b,c,d,e){a.order=c,a.getItemPrice=function(a){var b=0;return a.option&&a.option._id?((a.option_is_addon===!0||a.option_price_is_additive===!0)&&(b+=a.item_cost),b+=a.option.option_cost,_.each(a.sub_options,function(a){b+=a.sub_option_set[0].sub_option_cost}),_.each(a.addons,function(a){_.each(a.addon_set,function(a){b+=a.addon_cost})}),b):a.item_price},a.getItemTotal=function(){var a=0;return _.each(c.items,function(b){if(b.option&&b.option._id){(b.option_is_addon===!0||b.option_price_is_additive===!0)&&(a+=b.item_cost);var c=b.option.option_cost;_.each(b.sub_options,function(a){c+=a.sub_option_set[0].sub_option_cost}),_.each(b.addons,function(a){_.each(a.addon_set,function(a){c+=a.addon_cost})}),a+=c}else a+=b.item_price}),a},a.initEndTime=function(){"accepted"===a.order.order_status&&(a.order.end_time=new Date(a.order.order_date).getTime()+60*a.order.estimate_time*1e3)},a.acceptOrder=function(){if(a.order&&a.order.estimate_time){var b={};b.update_type="accept",b.estimate_time=a.order.estimate_time,d.updateOrder(b).then(function(b){console.log(b),e.swal("Update successful","Order accepted successfully","success"),a.order.order_status="accepted",a.initEndTime()},function(a){console.log(a)})}else e.swal("Validation error","Please provide valid estimate delivery time","error")},a.rejectOrder=function(){var b={};b.update_type="reject",d.updateOrder(b).then(function(b){console.log(b),e.swal("Update successful","Order rejected successfully","info"),a.order.order_status="rejected"},function(a){console.log(a)})},a.dispatchOrder=function(){var b={};b.update_type="dispatch",d.updateOrder(b).then(function(b){console.log(b),e.swal("Update successful",'Order status updated to "DISPATCHED"',"success"),a.order.order_status="dispatched"},function(a){console.log(a)})}}]),angular.module("consoleApp").controller("OrderManageController",["$scope","consoleRESTSvc","SweetAlert","$cookies","$rootScope","$notification","$stateParams",function(a,b,c,d,e,f,g){a.showing,g.show?"accept"===g.show?a.showing="ACCEPTED":"assumed_delivered"===g.show?a.showing="ASSUMED_DELIVERED":"reject"===g.show?a.showing="REJECTED":"dispatch"===g.show?a.showing="DISPATCHED":a.showing="PENDING":a.showing="PENDING",a.current_order=-1,a.reject_reasons=["Reason 1","Reason 2","Reason 3","Reason 4"],a.faye_handler=function(c){console.log("faye message",c),b.getOrder(c.order_id).then(function(b){e.notification_count+=1,e.sound.is_playing||(e.sound.is_playing=!0,e.sound.play());var d=f("New Order",{body:c.message||"You have an order",delay:0,dir:"auto"});d.$on("click",function(){console.debug("The user has clicked in my notification."),a.orders.push(b.data),a.updateShowing("pending"),d.close()}),d.$on("close",function(){console.debug("The user has closed my notification."),d.close(),e.notification_count-=1,e.notification_count||(e.sound.stop(),e.sound.is_playing=!1),a.updateShowing("PENDING")})},function(a){console.log("unable to load order",a)})},e.setHandler(a.faye_handler),a.updateShowing=function(b){a.showing=b,a.order={},a.filterOrders(),a.getOrders()},b.getOutlets().then(function(b){a.outlets=_.indexBy(b.data,"_id"),console.log("outlets",a.outlets),a.getOrders()},function(b){console.log(b),a.outlets={},a.getOrders()}),a.orders=[],a.filtered_orders=[],a.getOrders=function(){b.getOrders(a.choosen_outlet).then(function(b){console.log(b),a.orders=b.data,a.filterOrders()},function(a){console.log(a)})},a.filterOrders=function(){a.filtered_orders=_.filter(a.orders,function(b){return b.order_status===a.showing})},a.order={},a.getItemPrice=function(a){var b=0;return a.option&&a.option._id?(b+=a.option.option_cost,a.option.option_price_is_additive===!0&&(b+=a.item_cost),a.option.sub_options&&a.option.sub_options.length&&_.each(a.option.sub_options,function(a){b+=a.sub_option_set[0].sub_option_cost}),a.option.addons&&a.option.addons.length&&_.each(a.option.addons,function(a){
_.each(a.addon_set,function(a){b+=a.addon_cost})}),b):a.item_cost},a.updateEstimateTime=function(a,b){a.estimate_time+=b},a.getDiscount=function(a){return a.order_value_without_offer-a.order_value_with_offer+a.order_value_with_offer*(a.cash_back/100)},a.viewOrder=function(b,c){a.order=b,a.current_order=c},a.acceptOrder=function(){var e=_.cloneDeep(a.order);e.update_type="accept",e.order_id=a.order._id,e.am_email=d.get("user"),c.swal({title:"Estimate Time?",text:"Provide an estimate time for delivery - in minutes.",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top"},function(d){var f;if(!d)return swal.showInputError("Estimate delivery time (in mins.) required"),!1;try{if(f=Number(d),f!==f)return swal.showInputError("Valid estimate delivery time(in minutes) required"),!1;e.estimate_time=f,b.updateOrder(e).then(function(b){console.log(b),a.order.order_status="ACCEPTED",a.order.actions.push({action_type:"ACCEPTED",action_at:new Date}),a.orders[a.current_order]=a.order,c.swal("SUCCESS","Order accepted successfully","success"),a.filterOrders()},function(a){console.log(a),c.swal("ERROR",a.message?a.message:"Something went wrong. Please try after sometime.","error")})}catch(g){return swal.showInputError("Valid estimate delivery time(in minutes) required"),!1}})},a.showReject=function(){a.show_reject_msg=!0},a.rejectOrder=function(e){var f=_.cloneDeep(a.order);f.update_type="reject",f.order_id=a.order._id,f.am_email=d.get("user"),c.swal({title:"Are you sure?",text:"This is an irreversible change. Do you still want to proceed?",type:"warning",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top"},function(d){return d?(f.reject_reason=e,b.updateOrder(f).then(function(b){a.order.order_status="REJECTED",a.order.actions.push({action_type:"REJECTED",action_at:new Date,comments:e}),a.orders[a.current_order]=a.order,c.swal("SUCCESS","Order rejected successfully","info"),a.filterOrders()},function(a){console.log(a),c.swal("ERROR",a.message?a.message:"Something went wrong. Please try after sometime.","error")}),!0):void 0})},a.dispatchOrder=function(){var e=_.cloneDeep(a.order);e.update_type="dispatch",e.order_id=a.order._id,e.am_email=d.get("user"),b.updateOrder(e).then(function(b){a.order.order_status="DISPATCHED",a.order.actions.push({action_type:"DISPATCHED",action_at:new Date}),a.orders[a.current_order]=a.order,c.swal("SUCCESS","Order dispatch updated successfully","success"),a.filterOrders()},function(a){console.log(a),c.swal("ERROR",a.message?a.message:"Something went wrong. Please try after sometime.","error")})}}]),angular.module("consoleApp").controller("OutletManageController",["$scope","$rootScope","consoleRESTSvc","$filter","SweetAlert",function(a,b,c,d,e){a.searchKeywords="",a.outlets=[],a.filtered_outlets=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_outlets=[],c.getOutlets().then(function(b){console.log(b),a.outlets=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_outlets=a.filtered_outlets.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_outlets=d("filter")(a.outlets,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_outlets=d("orderBy")(a.outlets,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_outlets=d("orderBy")(a.outlets,a.row):a.filtered_outlets=a.outlets,a.filtered_outlets=_.filter(a.filtered_outlets,function(a){return-1!==a.outlet_meta.status.indexOf(b)}),a.onFilterChange()},a.updateOutletStatus=function(a){c.updateOutlet(a).then(function(a){console.log(a),e.swal("SUCCESS","Outlet status updated","success")},function(a){console.log(a),a.message?e.swal("ERROR",a.message,"error"):e.swal("ERROR","Unable to update the outlet status right now","error")})},a.updateOutletServices=function(a){c.updateOutlet(a).then(function(a){console.log(a),e.swal("SUCCESS","Outlet  updated","success")},function(a){console.log(a),a.message?e.swal("ERROR",a.message,"error"):e.swal("ERROR","Unable to update the outlet right now","error")})}}]),angular.module("consoleApp").controller("OutletViewController",["$scope","consoleRESTSvc","$stateParams","$modal",function(a,b,c,d){a.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],a.map={center:{latitude:28.805422897457664,longitude:77.16647699812656},zoom:14},a.marker={id:0,coords:{latitude:28.6078341976,longitude:77.2465642784}},b.getOutlets().then(function(b){console.log(b),angular.forEach(b.data,function(b){b._id===c.outlet_id&&(a.outlet=angular.copy(b),a.outlet.attributes.cost_for_two.min=a.outlet.attributes.cost_for_two.min.toString(),a.outlet.attributes.cost_for_two.max=a.outlet.attributes.cost_for_two.max.toString(),a.map.center={latitude:a.outlet.contact.location.coords.latitude,longitude:a.outlet.contact.location.coords.longitude},a.marker.coords={latitude:a.outlet.contact.location.coords.latitude,longitude:a.outlet.contact.location.coords.longitude},angular.forEach(a.outlet.business_hours,function(a){angular.forEach(a.timings,function(a){var b=new Date;b.setHours(a.open.hr),b.setMinutes(a.open.min),b.setSeconds(0),b.setMilliseconds(0),a.open.time=_.clone(b),b.setHours(a.close.hr),b.setMinutes(a.close.min),a.close.time=_.clone(b)})}))})},function(a){console.log(a)}),a.updateCashbackAndCommission=function(){var b=d.open({animation:!0,templateUrl:"../common/templates/partials/outlet.cashback_commission.tmpl.html",size:"md",controller:"CashbackCommissionController",resolve:{outlet:function(){return a.outlet}}});b.result.then(function(b){a.outlet=b})}}]),angular.module("consoleApp").controller("PromoNotificationsController",["$scope","consoleRESTSvc","$modal","SweetAlert","$state",function(a,b,c,d,e){a.promo={message:"ONE PLUS ONE",detail:"For any product get another for free!",outlets:null,coupon_code:"#1PFREE"},a.all=!0,a.createNotification=function(){console.log("promo",a.promo),a.all&&(a.promo.outlets=null),b.createNotification(a.promo).then(function(a){console.log("res",a),d.swal({title:"SUCCESS",text:"Notification created successfully",type:"success"},function(){e.go("^.promo_notifications",{},{reload:!0})})},function(a){d.swal("Internal Error",a.message?a.message:"Something went wrong","error")})}}]),angular.module("consoleApp").controller("ReportedProblemManageController",["$scope","consoleRESTSvc","$filter",function(a,b,c){a.searchKeywords="",a.reported_problems=[],a.filtered_reported_problems=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_reported_problems=[],b.getAllEvents("report_problem").then(function(b){console.log(b),a.reported_problems=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.currentPage,c=d+a.numPerPage,a.current_page_reported_problems=a.filtered_reported_problems.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_reported_problems=c("filter")(a.reported_problems,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_reported_problems=c("orderBy")(a.reported_problems,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_reported_problems=c("orderBy")(a.reported_problems,a.row):a.filtered_reported_problems=a.reported_problems,a.filtered_reported_problems=_.filter(a.filtered_reported_problems,function(a){return-1!==a.event_meta.status.indexOf(b)}),a.onFilterChange()}}]),angular.module("consoleApp").controller("RootController",["$scope","$rootScope","$state","consoleRESTSvc","$cookies","SweetAlert",function(a,b,c,d,e,f){b.token||"console.login"===c.current.name||c.go("console.login",{},{reload:!0}),a.logout=function(){d.logout().then(function(a){a.response?(e.remove("user"),e.remove("token"),e.remove("role"),e.put("paths","[]"),b.user=void 0,b.token=void 0,b.role=void 0,b.paths=[],f.swal({title:"SUCCESS",text:"Logged out successfully",type:"success"},function(){c.go("console.login",{},{reload:!0})})):f.swal("ERROR",a.message,"error")},function(a){a.message&&f.swal("ERROR",a.message,"error")})}}]),angular.module("consoleApp").controller("ShoppingOfferCreateController",["$scope","consoleRESTSvc","$modal","SweetAlert","$state",function(a,b,c,d,e){a.offer={offers:[]},a.addNewOffer=function(){_id=void 0;var b=c.open({animation:!0,templateUrl:"../common/templates/partials/shopping_offer.tmpl.html",controller:"ShoppingOfferTemplateController",size:"lg",resolve:{is_new:function(){return!0},shopping_offer:function(){return{offer_status:"draft",offer_applicability:{monday:{closed:!1,timings:[{}]},tuesday:{closed:!1,timings:[{}]},wednesday:{closed:!1,timings:[{}]},thursday:{closed:!1,timings:[{}]},friday:{closed:!1,timings:[{}]},saturday:{closed:!1,timings:[{}]},sunday:{closed:!1,timings:[{}]}}}}}});b.result.then(function(b){_id=void 0,a.offer.offers.push(b)})},a.updateOffer=function(b){_id=a.offer._id;var d=c.open({animation:!0,templateUrl:"../common/templates/partials/shopping_offer.tmpl.html",controller:"CashbackOfferTemplateController",size:"lg",resolve:{is_new:function(){return!1},shopping_offer:function(){return _.cloneDeep(a.offer.offers[b])}}});d.result.then(function(c){_id=void 0,a.offer.offers[b]=c})},a.removeOffer=function(b){d.swal({title:"Delete Offer?",text:"This change (once saved) is irrevesable",type:"error",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!"},function(c){c&&a.offer.offers.splice(b,1)})},a.createOffer=function(){_.get(a.offer,"partner_name")?_.get(a.offer,"contact_person")?_.get(a.offer,"email")?_.get(a.offer,"phone")?_.get(a.offer,"source")?_.get(a.offer,"logo")?_.get(a.offer,"offers")&&a.offer.offers.length?b.createCashbackOffer(a.offer).then(function(a){console.log("res",a),d.swal({title:"SUCCESS",text:"Shopping offer created successfully",type:"success"},function(){e.go("^.shopping_offers_manage",{},{reload:!0})})},function(a){d.swal("Internal Error",a.message?a.message:"Something went wrong","error")}):d.swal("Validation Error","Atleast add one cashback offer","warning"):d.swal("Validation Error","source logo required","warning"):d.swal("Validation Error","offer source required","warning"):d.swal("Validation Error","Contact person's phone number required","warning"):d.swal("Validation Error","Contact person's email required","warning"):d.swal("Validation Error","Contact person's name required","warning"):d.swal("Validation Error","Partner name required","warning")}}]),angular.module("consoleApp").controller("ShoppingOfferUpdateController",["$scope","consoleRESTSvc","$modal","SweetAlert","$state","$stateParams",function(a,b,c,d,e,f){a.offer={offers:[]},b.getShoppingOffer(f.offer_id).then(function(b){a.offer=_.merge(a.offer,b.data)},function(a){console.log(a)}),a.addNewOffer=function(){_id=void 0;var b=c.open({animation:!0,templateUrl:"../common/templates/partials/shopping_offer.tmpl.html",controller:"ShoppingOfferTemplateController",size:"lg",resolve:{is_new:function(){return!0},shopping_offer:function(){return{offer_applicability:{monday:{closed:!1,timings:[{}]},tuesday:{closed:!1,timings:[{}]},wednesday:{closed:!1,timings:[{}]},thursday:{closed:!1,timings:[{}]},friday:{closed:!1,timings:[{}]},saturday:{closed:!1,timings:[{}]},sunday:{closed:!1,timings:[{}]}}}}}});b.result.then(function(b){_id=void 0,a.offer.offers.push(b)})},a.updateOffer=function(b){_id=a.offer._id;var d=c.open({animation:!0,templateUrl:"../common/templates/partials/shopping_offer.tmpl.html",controller:"CashbackOfferTemplateController",size:"lg",resolve:{is_new:function(){return!1},shopping_offer:function(){return _.cloneDeep(a.offer.offers[b])}}});d.result.then(function(c){_id=void 0,a.offer.offers[b]=c})},a.removeOffer=function(b){d.swal({title:"Delete Offer?",text:"This change (once saved) is irrevesable",type:"error",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!"},function(c){c&&a.offer.offers.splice(b,1)})},a.updateCashbackOffer=function(){_.get(a.offer,"partner_name")?_.get(a.offer,"contact_person")?_.get(a.offer,"email")?_.get(a.offer,"phone")?_.get(a.offer,"offers")&&a.offer.offers.length?b.updateCashbackOffer(a.offer).then(function(a){console.log("res",a),d.swal({title:"SUCCESS",text:"Cashback offers updated successfully",type:"success"},function(){e.go("^.shopping_offers_manage",{},{reload:!0})})},function(a){d.swal("Internal Error",a.message?a.message:"Something went wrong","error")}):d.swal("Validation Error","Atleast add one cashback offer","warning"):d.swal("Validation Error","Contact person's phone number required","warning"):d.swal("Validation Error","Contact person's email required","warning"):d.swal("Validation Error","Contact person's name required","warning"):d.swal("Validation Error","Partner name required","warning")}}]),angular.module("consoleApp").controller("ShoppingOffersManageController",["$scope","consoleRESTSvc","$filter",function(a,b,c){a.searchKeywords="",a.shopping_offers=[],a.filtered_shopping_offers=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_shopping_offers=[],b.getShoppingOffers().then(function(b){console.log(b),a.shopping_offers=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return c=(b-1)*a.numPerPage,d=c+a.numPerPage,a.current_page_shopping_offers=a.filtered_shopping_offers.slice(c,d)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_shopping_offers=c("filter")(a.shopping_offers,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_shopping_offers=c("orderBy")(a.shopping_offers,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0}}]),angular.module("consoleApp").controller("SuggestedOfferManageController",["$scope","consoleRESTSvc","$filter",function(a,b,c){a.searchKeywords="",a.suggested_offers=[],a.filtered_suggested_offers=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_suggested_offers=[],b.getAllEvents("submit_offer").then(function(b){console.log(b),a.suggested_offers=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_suggested_offers=a.filtered_suggested_offers.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),$scoep.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_suggested_offers=c("filter")(a.suggested_offers,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_suggested_offers=c("orderBy")(a.suggested_offers,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_suggested_offers=c("orderBy")(a.suggested_offers,a.row):a.filtered_suggested_offers=a.suggested_offers,a.filtered_suggested_offers=_.filter(a.filtered_suggested_offers,function(a){return-1!==a.event_meta.status.indexOf(b)}),a.onFilterChange()}}]),angular.module("consoleApp").controller("SuggestedOfferViewController",["$scope","consoleRESTSvc","$stateParams",function(a,b,c){b.getEvent(c.suggested_offer_id).then(function(b){console.log(b),a.offer=b.data},function(a){console.log(a)}),a.updateCheck=function(b,c){a[b]=c},a.loadOffers=function(){b.getOffers().then(function(b){console.log(b),a.offers=_.filter(b.data,function(b){return-1!==b.offer_outlets.indexOf(a.offer.event_outlet)&&b.offer_user_source&&b.offer_user_source==a.offer.event_user}),console.log(a.offers.length,b.data.length)},function(a){console.log(a)})},a.updateOfferId=function(b){console.log(b),a.offer.event_meta.actual_offer=b._id},a.processOffer=function(){if(console.log(a.offer),!a.disable_input){a.disable_input=!0;var c=_.cloneDeep(a.offer);c.event_meta.status="twyst_approved",delete c.event_meta.user,b.updateEvent(event).then(function(b){a.disable_input=!1,c.event_meta.user=a.offer.event_meta.user,a.offer=_.cloneDeep(c),SweetAlert.swal("SUCCESS","Updated successfully","success")},function(b){a.disable_input=!1,SweetAlert.swal("ERROR",b.message?b.message:"Error occured while trying to update","error")})}},a.rejectOffer=function(){if(!a.disable_input){a.disable_input=!0;var c=_.cloneDeep(a.offer);c.event_meta.status="twyst_rejected",delete c.event_meta.user,a.isValidInput?a.offerOnTwyst&&(c.event_meta.rejected=!0,c.event_meta.reason="Offer already on Twyst"):(c.event_meta.rejected=!0,c.event_meta.reason="Offer not valid for the outlet"),b.updateEvent(c).then(function(b){a.disable_input=!1,c.event_meta.user=a.offer.event_meta.user,a.offer=_.cloneDeep(c),SweetAlert.swal("SUCCESS","Updated successfully","success")},function(b){a.disable_input=!1,SweetAlert.swal("ERROR",b.message?b.message:"Error occured while trying to update","error")})}}}]),angular.module("consoleApp").controller("SuggestedOutletManageController",["$scope","consoleRESTSvc","$filter",function(a,b,c){a.searchKeywords="",a.suggested_outlets=[],a.filtered_suggested_outlets=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_suggested_outlets=[],b.getAllEvents("suggestion").then(function(b){console.log(b),a.suggested_outlets=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_suggested_outlets=a.filtered_suggested_outlets.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),$scoep.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_suggested_outlets=c("filter")(a.suggested_outlets,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_suggested_outlets=c("orderBy")(a.suggested_outlets,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_suggested_outlets=c("orderBy")(a.suggested_outlets,a.row):a.filtered_suggested_outlets=a.suggested_outlets,a.filtered_suggested_outlets=_.filter(a.filtered_suggested_outlets,function(a){return-1!==a.event_meta.status.indexOf(b)}),a.onFilterChange()}}]),angular.module("consoleApp").controller("TestPaymentController",["$scope","toastr","consoleRESTSvc","$log",function(a,b,c,d){a.calculate_checksum=function(){a.checksum="915f037be216e5f6e2b7f235a3d5add73fda96e47461bbd6230a64bfb1082e12"}}]),angular.module("consoleApp").controller("UserFeedbackManageController",["$scope","consoleRESTSvc","$filter",function(a,b,c){a.searchKeywords="",a.user_feedbacks=[],a.filtered_user_feedbacks=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_user_feedbacks=[],b.getAllEvents("feedback").then(function(b){console.log(b),a.user_feedbacks=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_user_feedbacks=a.filtered_user_feedbacks.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){return a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_user_feedbacks=c("filter")(a.user_feedbacks,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_user_feedbacks=c("orderBy")(a.user_feedbacks,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_user_feedbacks=c("orderBy")(a.user_feedbacks,a.row):a.filtered_user_feedbacks=a.user_feedbacks,a.filtered_user_feedbacks=_.filter(a.filtered_user_feedbacks,function(a){return-1!==a.event_meta.status.indexOf(b)}),a.onFilterChange()}}]),angular.module("consoleApp").controller("WriteToTwystManageController",["$scope","consoleRESTSvc","$filter",function(a,b,c){a.searchKeywords="",a.write_to_twyst=[],a.filtered_write_to_twyst=[],a.row="",a.numPerPageOpt=[5,10,20,40],a.numPerPage=a.numPerPageOpt[1],a.currentPage=1,a.current_page_write_to_twyst=[],b.getAllEvents("write_to_twyst").then(function(b){console.log(b),a.write_to_twyst=b.data,a.search(),a.select(a.currentPage)},function(a){console.log(a)}),a.select=function(b){var c,d;return d=(b-1)*a.numPerPage,c=d+a.numPerPage,a.current_page_write_to_twyst=a.filtered_write_to_twyst.slice(d,c)},a.onFilterChange=function(){return a.select(1),a.currentPage=1,a.row=""},a.onNumPerPageChange=function(){a.select(1),a.currentPage=1},a.onOrderChange=function(){return a.select(1),a.currentPage=1},a.search=function(){return a.filtered_write_to_twyst=c("filter")(a.write_to_twyst,a.searchKeywords),a.view_status&&a.sort(a.view_status),a.onFilterChange()},a.order=function(b){return a.row!==b?(a.row=b,a.filtered_write_to_twyst=c("orderBy")(a.write_to_twyst,b),a.view_status&&a.sort(a.view_status),a.onOrderChange()):void 0},a.sort=function(b){console.log("view_status",b),a.row?a.filtered_write_to_twyst=c("orderBy")(a.write_to_twyst,a.row):a.filtered_write_to_twyst=a.write_to_twyst,a.filtered_write_to_twyst=_.filter(a.filtered_write_to_twyst,function(a){return-1!==a.event_meta.status.indexOf(b)}),a.onFilterChange()}}]),angular.module("consoleApp").directive("imagereader",["imageSvc","toastr",function(a,b){return{require:"ngModel",restrict:"E",template:"<img class='img-polaroid'/><input id='fileInput' type='file' style='display: none;'/>",link:function(b,c,d,e){var f=$(angular.element('<input id="fileInput" type="file" />')),g=c.find("img")[0];f.on("change",function(b){var c=b.target.files[0],f=/^image\//i;if(f.test(c.type)){var h=new FileReader;h.onload=function(b){console.log(b.target.result);var c={image:b.target.result,image_class:d.ngImageFor,image_type:d.ngImageType};_id&&(c.id=_id),"menu"===d.ngImageFor&&e.$modelValue&&(c.item=e.$modelValue),a.uploadImage(c).then(function(a){_id=a.data.id,$(g).attr("src",b.target.result),e.$setViewValue(a.data.key.toString())},function(a){console.log("err",a)})},h.readAsDataURL(b.target.files[0])}}),c.bind("click",function(){f.trigger("click")}),c.css("cursor","pointer"),b.$watch(function(){return e.$modelValue},function(a){console.log("ngImageFor",d.ngImageFor,a),a&&(/^http/i.test(a)?$(g).attr("src",a):"menu"===d.ngImageFor?$(g).attr("src","https://s3-us-west-2.amazonaws.com/retwyst-merchants/retwyst-menus/"+_id+"/items/"+a):"outlet"===d.ngImageFor?$(g).attr("src","https://s3-us-west-2.amazonaws.com/retwyst-merchants/retwyst-outlets/"+_id+"/"+a):"shopping_offer"===d.ngImageFor?$(g).attr("src","https://s3-us-west-2.amazonaws.com/retwyst-merchants/shopping-offers/partner/"+_id+"/logo"):"push_notif"===d.ngImageFor?$(g).attr("src","https://s3-us-west-2.amazonaws.com/retwyst-app/banners/"+_id+"/logo"):"banner"===d.ngImageFor&&$(g).attr("src","https://s3-us-west-2.amazonaws.com/retwyst-app/push_notifications/"+_id+"/logo"))})}}}]),angular.module("consoleApp").directive("toggleNavCollapsedMin",["$rootScope",function(a){function b(b,c,d){var e;e=$("#app"),c.on("click",function(b){return e.hasClass("nav-collapsed-min")?e.removeClass("nav-collapsed-min"):(e.addClass("nav-collapsed-min"),a.$broadcast("nav:reset")),b.preventDefault()})}var c={restrict:"A",link:b};return c}]),angular.module("consoleApp").directive("ngFocus",["$timeout",function(a){return{link:function(b,c,d){b.$watch(d.ngFocus,function(b){angular.isDefined(b)&&b&&a(function(){c[0].focus()})},!0),c.bind("blur",function(){angular.isDefined(d.ngFocusLost)&&b.$apply(d.ngFocusLost)})}}}]),angular.module("consoleApp").directive("uiFileUpload",function(){return{restrict:"A",link:function(a,b){b.bootstrapFileInput()}}}),angular.module("consoleApp").factory("consoleRESTSvc",["$http","$q","$cookies","$localStorage",function(a,b,c,d){var e={};return e.login=function(c){var d=b.defer();return a.post("/api/v4/accounts/login",c).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.logout=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/accounts/logout?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.refreshOutlets=function(){var e=b.defer(),f=c.get("token");return a.get("/api/v4/outlets?token="+f).then(function(a){console.log(a),a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){d.outlets=[],console.log(a),e.reject(a)}),e.promise},e.refreshOffers=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/offers?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.refreshQRs=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/qr?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.getOutlets=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/outlets?token="+e).then(function(a){console.log(a),a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.updateOutlet=function(d){var e=b.defer(),f=c.get("token");return a.put("/api/v4/outlets/"+d._id+"?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.getOffers=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/offers?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.getOffer=function(d){var e=b.defer(),f=c.get("token");return a.get("/api/v4/offers/"+d+"?token="+f).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.updateOfferStatus=function(d){var e=b.defer(),f=c.get("token");return a.put("/api/v4/offers/"+d._id+"?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.getQRs=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/qr?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.getAllEvents=function(d){var e=b.defer(),f=c.get("token");return a.get("/api/v4/events/list/"+d+"?token="+f).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.getEvent=function(d){var e=b.defer(),f=c.get("token");return a.get("/api/v4/events/retrieve/"+d+"?token="+f).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.updateEvent=function(d){var e=b.defer(),f=c.get("token");return a.put("/api/v4/events/update/"+d._id+"?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.bulkCheckin=function(d){var e=b.defer(),f=c.get("token");return a.post("/api/v4/checkin/bulk?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.registerMerchant=function(c){var d=b.defer();return a.post("/api/v4/auth/register",c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},e.getMenus=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/menu?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.getMenu=function(d){var e=b.defer(),f=c.get("token");return a.get("/api/v4/menus/"+d+"?token="+f).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.deleteMenu=function(d){var e=b.defer(),f=c.get("token");return a["delete"]("/api/v4/menus/"+d+"?token="+f).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.createMenu=function(d){var e=b.defer(),f=c.get("token");return a.post("/api/v4/menu?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.updateMenu=function(d){var e=b.defer(),f=c.get("token");return a.put("/api/v4/menus/"+d._id+"?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.cloneMenu=function(d,e){var f=b.defer(),g=c.get("token");return a.post("/api/v4/menus/clone?token="+g,{menu:d,outlet:e}).then(function(a){a.data.response?f.resolve(a.data):f.reject(a.data)},function(a){f.reject(a)}),f.promise},e.getOrders=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/orders?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.getOrder=function(d){var e=b.defer(),f=c.get("token");return a.get("/api/v4/orders?token="+f).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.updateOrder=function(d){var e=b.defer(),f=c.get("token");return a.put("/api/v4/outlet/order/"+d._id+"?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.createNotification=function(d){var e=b.defer(),f=c.get("token");return a.post("/api/v4/promo_notif/send?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.getCoupons=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/coupons?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.getCoupon=function(c){var d=b.defer();return a.get("/api/v4/coupons"+coupon_id).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.createCoupon=function(d){var e=b.defer(),f=c.get("token");return console.log("coupon object",d),a.post("/api/v4/coupons?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.updateCouponOffer=function(c){var d=b.defer();return a.put("/api/v4/banners/"+c._id).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.deleteCouponOffer=function(c){var d=b.defer();return a["delete"]("/api/v4/banners/"+c._id).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.getShoppingOffers=function(){var d=b.defer(),e=c.get("token");return a.get("/api/v4/cashback/offers?token="+e).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},e.getShoppingOffer=function(d){var e=b.defer(),f=c.get("token");return a.get("/api/v4/cashback/offers/"+d+"?token="+f).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.createShoppingOffer=function(d){
var e=b.defer(),f=c.get("token");return a.post("/api/v4/cashback/offers?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.updateShoppingOffer=function(d){var e=b.defer(),f=c.get("token");return a.put("/api/v4/cashback/offers/"+d._id+"?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e.deleteShoppingOffer=function(d){var e=b.defer(),f=c.get("token");return a["delete"]("/api/v4/cashback/offers/"+d._id+"?token="+f,d).then(function(a){a.data.response?e.resolve(a.data):e.reject(a.data)},function(a){e.reject(a)}),e.promise},e}]),angular.module("consoleApp").factory("imageSvc",["$http","$q",function(a,b){var c={};return c.uploadImage=function(c){var d=b.defer();return a.post("/api/v4/images",c).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},c.cloneImage=function(c){var d=b.defer();return a.post("/api/v4/images/clone",c).then(function(a){a.data.response?d.resolve(a.data):d.reject(a.data)},function(a){d.reject(a)}),d.promise},c}]);